<!DOCTYPE html>
<html>

<head>
  <title>Depth-First Search</title>
  <link rel="stylesheet" href="../../../JSAV/css/JSAV.css" type="text/css" media="screen" title="no title"
    charset="utf-8" />
  <style>
    #av {
      width: 98%;
      position: relative;
    }

    .jsavcounter {
      position: absolute;
      top: 15px;
    }

    .jsavcanvas {
      height: 300px;
    }

    .visited {
      background-color: #ddd;
    }

    .processing {
      border-color: red;
    }

    .finished {
      background-color: black;
      color: white;
    }

    .jsavlabel {
      font-size: 2em;
      text-align: center;
    }

    .buttons-container {
      margin-top: 10px;
      display: flex;
      flex-direction: row;
      width: 100%;
      justify-content: space-between;
    }
    .node-number{
      margin: 1rem;
    }
    .add-node{
      margin: 1rem;
    }
    .remove-node{
      margin: 1rem;
    }
    .connect-nodes{
      margin: 1rem;
    }
    .disconnect-nodes{
      margin: 1rem;
    }
  </style>
</head>

<body>
  <h1>JSAV slideshow for graphs</h1>
  <div id="av">
    <div class="jsavcontrols"></div>
    <div class="buttons-container">
      <div class="node-number"> 
        <button onclick="clearGraph()">Clear</button>
      </div>
      <div class="node-number"> 
        <button onclick="numberOfNodes()">Number of Nodes</button>
      </div>
      <div class="node-number"> 
        <button onclick="numberOfEdges()">Number of Edges</button>
      </div>
      <div class="add-node">
        <input type="text" id="addNodeInput" placeholder=" Add node to graph">
        <button onclick="addNode()">Add A Node</button>
      </div>
      <div class="remove-node">
        <input type="text" id="removeNodeInput" placeholder="Remove node from graph">
        <button onclick="removeNode()">Remove A Node</button>
      </div>
      <div class="connect-nodes"><input type="text" id="addFromNode" placeholder="Add edge from node">
        <input type="text" id="addToNode" placeholder="Add edge to node">
        <button onclick="connectNodes()">Add An Edge</button>
      </div>
      <div class="disconnect-nodes"><input type="text" id="removeFromNode" placeholder="Remove edge from node">
        <input type="text" id="removeToNode" placeholder="Remove edge to node">
        <button onclick="disconnectNodes()">Remove An Edge</button>
      </div>
    </div>
    <span class="jsavcounter"></span>
    <p class="jsavoutput jsavline"></p>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <script src="../../../JSAV/lib/jquery.transit.js"></script>
  <script src="../../../JSAV/lib/raphael.js"></script>
  <script src="../../../JSAV/lib/dagre.min.js"></script>
  <script src="../../../JSAV/build/JSAV.js"></script>
  <script>
    let addNodeInput = document.getElementById("addNodeInput");
    let removeNodeInput = document.getElementById("removeNodeInput");
    let addFromNode = document.getElementById("addFromNode");
    let addToNode = document.getElementById("addToNode");
    let removeFromNode = document.getElementById("removeFromNode");
    let removeToNode = document.getElementById("removeToNode");
    var jsav = new JSAV("av");
    jsav.label("Layered graph layout")
    const graph = jsav.ds.graph($.extend({ width: 500, height: 350 }, { layout: "layered" }, { directed: true }));
    graph.layout();
    jsav.displayInit();

    // function to get the number of nodes in the graph
    function numberOfNodes() {
      jsav.umsg("Number of nodes in the graph: " + graph.nodeCount());
      return graph.nodeCount();
    }

    // function to get the number of edges in the graph
    function numberOfEdges() {
      jsav.umsg("Number of edges in the graph: " + graph.edgeCount());
      return graph.edgeCount();
    }

    // function to get a node by its value
    function getNode(value) {
      let nodes = graph.nodes();
      for (let i = 0; i < nodes.length; i++) {
        if (nodes[i].value() === value) {
          return nodes[i];
        }
      }
      return null;
    }

    // function to add a node to the graph
    function addNode() {
      const { value } = addNodeInput;
      if (value != "") {
        // check if the node already exists
        if (getNode(value) === null) {
          graph.addNode(value);
          jsav.umsg("Added node " + value);
          // clear input field
          addNodeInput.value = "";
        } else {
          jsav.umsg("Node " + value + " already exists");
        }
      }
      else {
        jsav.umsg("Please enter a value");
      }
      graph.layout();
      jsav.displayInit();
    }
    // function to remove a node from the graph
    function removeNode() {
      const { value } = removeNodeInput;
      if (value != "") {
        // check if the node exists
        if (isNodeInGraph(value)) {
          const currentNode = getNode(value);
          graph.removeNode(currentNode);
          jsav.umsg(`Removed ${value} from the graph`);
          // clear input field
          removeNodeInput.value = "";
        }
        else {
          jsav.umsg(`Node ${value} does not exist`);

        }
      }
      else {
        jsav.umsg("Please enter a value");

      }
      graph.layout();
      jsav.displayInit();

    }
    // function to connect two nodes
    function connectNodes() {
      const { value: from } = addFromNode;
      const { value: to } = addToNode;

      console.log("Value of form and to", from, to);
      if (from != "" && to != "") {
        // check if the nodes exist
        if (isNodeInGraph(from) && isNodeInGraph(to)) {
          const fromNode = getNode(from);
          const toNode = getNode(to);
          graph.addEdge(fromNode, toNode);
          jsav.umsg(`Added edge from ${from} to ${to}`);
          graph.layout();
          jsav.displayInit();
          // clear input fields
          addFromNode.value = "";
          addToNode.value = "";
        }
        else {
          jsav.umsg(`Node ${from} or ${to} does not exist`);
        }
      }
      else {
        jsav.umsg("Please enter a value");

      }

    }
    // function to disconnect two nodes
    function disconnectNodes() {
      const { value: from } = removeFromNode;
      const { value: to } = removeToNode;
      if (from != "" && to != "") {
        // check if the nodes exist
        if (isNodeInGraph(from) && isNodeInGraph(to)) {
          const fromNode = getNode(from);
          const toNode = getNode(to);
          graph.removeEdge(fromNode, toNode);
          jsav.umsg(`Removed edge from ${from} to ${to}`);
          graph.layout();
          jsav.displayInit();
          // clear input fields
          removeFromNode.value = "";
          removeToNode.value = "";
        }
        else {
          jsav.umsg(`Node ${from} or ${to} does not exist`);
        }
      }
      else {
        jsav.umsg("Please enter a value");

      }
     

    }

    // function to clear the graph
    function clearGraph() {
    //  reload the window
      window.location.reload();
    } 


    var preVisit = function(node, prev) {
      node.addClass("processing");
      jsav.umsg("Add node " + node.value() + " to the DFS search tree");
      if (prev) {
        node.edgeFrom(prev).css("stroke", "red"); // highlight
        node.edgeTo(prev).css("stroke", "red"); // highlight
      }
      jsav.step();
    };
    var visit = function(node) {
      node.addClass("visited");
      jsav.umsg("Call DFS for node " + node.value());
      jsav.step();
   
    };
    var postVisit = function(node) {
      node.addClass("finished");
      jsav.umsg("Done with node " + node.value());
      jsav.step();
    };
    var dfs = function(start, prev) {
      var successors,
          next;
      preVisit(start, prev);
      successors = start.neighbors();
      for (next = successors.next(); next; next = successors.next()) {
        if (!next.hasClass("visited")) {
          visit(next);
          dfs(next, start);
        }
      }
      postVisit(start);
    };
    visit(graph.nodes()[0]);
    dfs(graph.nodes()[0]);
    jsav.recorded();

    //check if a node is in the graph
    function isNodeInGraph(node) {
      let nodes = graph.nodes();
      for (let i = 0; i < nodes.length; i++) {
        if (nodes[i].value() == node) {
          return true;
        }
      }
      return false;
    }


  </script>
</body>

</html>