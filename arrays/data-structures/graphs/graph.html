<!DOCTYPE html>
<html>

<head>
  <title>Graph Visualization</title>
  <link rel="stylesheet" href="../../../JSAV/css/JSAV.css" type="text/css" media="screen" title="no title"
    charset="utf-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">


  <style>
    #av {
      width: 98%;
      position: relative;
      border: 2px solid rgb(114, 109, 109);
      background-color: #ccc;
    }

    .jsavcounter {
      position: absolute;
      top: 15px;
    }

    .jsavcanvas {
      height: 300px;
    }

    .visited {
      background-color: #ddd;
    }

    .processing {
      border-color: red;
    }

    .finished {
      background-color: black;
      color: white;
    }

    .jsavlabel {
      font-size: 2em;
      text-align: center;
    }

    input {
      margin: 0.5rem;
      /* add a border */
      border: 2px solid #ccc;
      padding: 1em;
    }

    button {
      padding: 12px;
      font-weight: bolder;
      background-color: #5d2cff;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      border: white;
      margin: 0 2%;
      cursor: pointer;
    }

    .buttons-container {
      margin: auto;
      display: flex;
      flex-direction: row;
      width: 80%;
      justify-content: space-between;
    }

    .node-number {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      margin: 1rem;
    }
  </style>
</head>

<body>
  <h1>Graph Visualization</h1>
  <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="av">

          <div class="jsavcontrols"></div>
          <div class="start-slideshow">
          </div>
          <div class="buttons-container">
            <div class="node-number">
              <button onclick="startSlideShow()" id="startSlideShow">Slideshow</button>
              <button onclick="clearGraph()" id="clearGraph">Clear</button>
            </div>
            <div class="node-number">
              <button onclick="numberOfNodes()" id="numberOfNodes">Number of Nodes</button>
              <button onclick="numberOfEdges()" id="numberOfEdges">Number of Edges</button>
            </div>
            <div class="node-number">
              <input type="text" id="addNodeInput" placeholder=" Add node to graph">
              <button onclick="addNode()" id="addNode">Add A Node</button>
            </div>
            <div class="node-number">
              <input type="text" id="removeNodeInput" placeholder="Remove node from graph">
              <button onclick="removeNode()" id="removeNode">Remove A Node</button>
            </div>
            <div class="node-number">
              <input type="text" id="addFromNode" placeholder="Add edge from node">
              <input type="text" id="addToNode" placeholder="Add edge to node">
              <button onclick="connectNodes()" id="addEdge">Add An Edge</button>
            </div>
            <div class="node-number">
              <input type="text" id="removeFromNode" placeholder="Remove edge from node">
              <input type="text" id="removeToNode" placeholder="Remove edge to node">
              <button onclick="disconnectNodes()" id="removeEdge">Remove An Edge</button>
            </div>
          </div>
          <span class="jsavcounter"></span>
          <p class="jsavoutput jsavline"></p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <script src="../../../JSAV/lib/jquery.transit.js"></script>
  <script src="../../../JSAV/lib/raphael.js"></script>
  <script src="../../../JSAV/lib/dagre.min.js"></script>
  <script src="../../../JSAV/build/JSAV.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script> 

  <script>
    let addNodeInput = document.getElementById("addNodeInput");
    let removeNodeInput = document.getElementById("removeNodeInput");
    let addFromNode = document.getElementById("addFromNode");
    let addToNode = document.getElementById("addToNode");
    let removeFromNode = document.getElementById("removeFromNode");
    let removeToNode = document.getElementById("removeToNode");
    //define the buttons
    let addNodeButton = document.getElementById("addNode");
    let removeNodeButton = document.getElementById("removeNode");
    let addEdgeButton = document.getElementById("addEdge");
    let removeEdgeButton = document.getElementById("removeEdge");
    let numberOfNodesButton = document.getElementById("numberOfNodes");
    let numberOfEdgesButton = document.getElementById("numberOfEdges");
    let clearGraphButton = document.getElementById("clearGraph");
    let startSlideShowButton = document.getElementById("startSlideShow");


    const jsav = new JSAV("av");
    jsav.label("Layered graph layout")
    const graph = jsav.ds.graph($.extend({ width: 500, height: 350 }, { layout: "layered" }, { directed: true }));
    graph.layout();
    jsav.displayInit();

    // start the slideshow
    function startSlideShow() {
      jsav.displayInit();
      traverse();
      jsav.recorded();
      disableButtons();
    }
    // function to get the number of nodes in the graph
    function numberOfNodes() {
      jsav.umsg("Number of nodes in the graph: " + graph.nodeCount());
      return graph.nodeCount();
    }
    // function to get the number of edges in the graph
    function numberOfEdges() {
      jsav.umsg("Number of edges in the graph: " + graph.edgeCount());
      return graph.edgeCount();
    }
    // function to get a node by its value
    function getNode(value) {
      let nodes = graph.nodes();
      for (let i = 0; i < nodes.length; i++) {
        if (nodes[i].value() === value.toUpperCase()) {
          return nodes[i];
        }
      }
      return null;
    }
    //check if a node is in the graph
    function isNodeInGraph(node) {
      let nodes = graph.nodes();
      for (let i = 0; i < nodes.length; i++) {
        if (nodes[i].value() == node) {
          return true;
        }
      }
      return false;
    }
    // function to add a node to the graph
    function addNode() {
      const { value } = addNodeInput;
      if (value != "") {
        // check if the node already exists
        if (getNode(value.toUpperCase()) === null) {
          graph.addNode(value.toUpperCase());
          jsav.umsg("Added node " + value.toUpperCase());
          // clear input field
          addNodeInput.value = "";
          graph.layout();
          jsav.displayInit();
          jsav.step();
        } else {
          jsav.umsg("Node " + value.toUpperCase() + " already exists");
        }
      }
      else {
        jsav.umsg("Please enter a value");
      }
    }
    // function to remove a node from the graph
    function removeNode() {
      const { value } = removeNodeInput;
      if (value != "") {
        // check if the node exists
        if (isNodeInGraph(value.toUpperCase())) {
          const currentNode = getNode(value.toUpperCase());
          graph.removeNode(currentNode);
          jsav.umsg(`Removed ${value.toUpperCase()} from the graph`);
          // clear input field
          removeNodeInput.value = "";
          graph.layout();
          jsav.displayInit();
          jsav.step();
        }
        else {
          jsav.umsg(`Node ${value.toUpperCase()} does not exist`);

        }
      }
      else {
        jsav.umsg("Please enter a value");

      }

    }
    // function to connect two nodes
    function connectNodes() {
      const { value: from } = addFromNode;
      const { value: to } = addToNode;

      if (from != "" && to != "") {
        // check if the nodes exist
        if (isNodeInGraph(from.toUpperCase()) && isNodeInGraph(to.toUpperCase())) {
          const fromNode = getNode(from.toUpperCase());
          const toNode = getNode(to.toUpperCase());
          graph.addEdge(fromNode, toNode);
          jsav.step();
          jsav.umsg(`Added edge from ${from.toUpperCase()} to ${to.toUpperCase()}`);
          graph.layout();
          jsav.displayInit();
          // clear input fields
          addFromNode.value = "";
          addToNode.value = "";


        }
        else {
          jsav.umsg(`Node ${from.toUpperCase()} or ${to.toUpperCase()} does not exist`);
        }
      }
      else {
        jsav.umsg("Please enter a value");

      }
    }
    // function to disconnect two nodes
    function disconnectNodes() {
      const { value: from } = removeFromNode;
      const { value: to } = removeToNode;
      if (from != "" && to != "") {
        // check if the nodes exist
        if (isNodeInGraph(from.toUpperCase()) && isNodeInGraph(to.toUpperCase())) {
          const fromNode = getNode(from.toUpperCase());
          const toNode = getNode(to.toUpperCase());
          graph.removeEdge(fromNode, toNode);
          jsav.umsg(`Removed edge from ${from.toUpperCase()} to ${to.toUpperCase()}`);
          graph.layout();
          jsav.displayInit();
          // clear input fields
          removeFromNode.value = "";
          removeToNode.value = "";
          jsav.step();
        }
        else {
          jsav.umsg(`Node ${from.toUpperCase()} or ${to.toUpperCase()} does not exist`);
        }
      }
      else {
        jsav.umsg("Please enter a value");

      }
    }
    // function to clear the graph
    function clearGraph() {
      //  reload the window
      window.location.reload();
    }
    // function to visit a node
    function visit(node) {
      node.highlight();
      jsav.umsg("Visiting node " + node.value());
      jsav.step();
      node.unhighlight();
      let neighbors = node.neighbors();
      for (let i = 0; i < neighbors.length; i++) {
        if (!neighbors[i].hasClass("visited")) {
          neighbors[i].addClass("visited");
          visit(neighbors[i]);
        }
      }
    }

    // function to traverse the graph should visit all nodes
    function traverse() {
      let nodes = graph.nodes();
      for (let i = 0; i < nodes.length; i++) {
        if (!nodes[i].hasClass("visited")) {
          nodes[i].addClass("visited");
          visit(nodes[i]);
        }
      }
    }


    // function to get the degree of a node
    function getDegree() {
      const { value } = degreeNode;
      if (value != "") {
        // check if the node exists
        if (isNodeInGraph(value.toUpperCase())) {
          const currentNode = getNode(value.toUpperCase());
          jsav.umsg(`Degree of ${value.toUpperCase()} is ${currentNode.neighbors().length}`);
          // clear input field
          degreeNode.value = "";
          jsav.step();
        }
        else {
          jsav.umsg(`Node ${value.toUpperCase()} does not exist`);
        }
      }
      else {
        jsav.umsg("Please enter a value");

      }
    }

    // funtion that returns the root node in the graph
    function getRoot() {
      let nodes = graph.nodes();
      for (let i = 0; i < nodes.length; i++) {
        if (nodes[i].neighbors().length === 0) {
          return nodes[i];
        }
      }
      return null;
    }

    // funtion to disable all buttons when the slideshow starts
    function disableButtons() {
      // check if graph is empty
      if (graph.nodes().length !== 0) {
        addNodeButton.disabled = true;
        removeNodeButton.disabled = true;
        addEdgeButton.disabled = true;
        removeEdgeButton.disabled = true;
        numberOfNodesButton.disabled = true;
        numberOfEdgesButton.disabled = true;
        startSlideShowButton.disabled = true;
        // change the color of the buttons when they are disabled to grey
        addNodeButton.style.backgroundColor = "grey";
        removeNodeButton.style.backgroundColor = "grey";
        addEdgeButton.style.backgroundColor = "grey";
        removeEdgeButton.style.backgroundColor = "grey";
        numberOfNodesButton.style.backgroundColor = "grey";
        numberOfEdgesButton.style.backgroundColor = "grey";
        startSlideShowButton.style.backgroundColor = "grey";
      }
    }
  </script>
</body>

</html>